{% extends 'registrations/admin/base.html' %}
{% load static %}

{% block page_title %}Settings & Configuration{% endblock %}

{% block content %}
<div class="fade-in-up settings-page">
  <!-- Cohorts Section -->
  <div class="data-table fade-in-up" style="animation-delay: 0.1s; margin-bottom: 32px;">
    <div class="table-header">
      <h2 class="table-title">Cohorts</h2>
      <a href="{% url 'add_cohort' %}" class="btn btn-primary btn-sm">
        <iconify-icon icon="lucide:plus"></iconify-icon>
        Add Cohort
      </a>
    </div>
    <div class="table-content">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Code</th>
            <th>Type</th>
            <th>Status</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for cohort in cohorts %}
          <tr>
            <td style="font-weight: 600;">{{ cohort.name }}</td>
            <td>
              <span class="badge badge-info" style="background: #dbeafe; color: #0071e3; border: 1px solid rgba(0, 113, 227, 0.2); font-weight: 600;">
                {{ cohort.code }}
              </span>
            </td>
            <td>{% if cohort.is_new_intake %}<span class="badge badge-success">New Intake</span>{% else %}<span class="badge">Returning</span>{% endif %}</td>
            <td>
              {% if cohort.is_active %}
                <span class="badge badge-success">Active</span>
              {% else %}
                <span class="badge badge-danger">Inactive</span>
              {% endif %}
            </td>
            <td>{{ cohort.start_date|default:"-" }}</td>
            <td>{{ cohort.end_date|default:"-" }}</td>
            <td>
              <div class="action-buttons">
                <a href="{% url 'edit_cohort' cohort.id %}" class="action-btn action-btn-edit" title="Edit">
                  <iconify-icon icon="lucide:edit"></iconify-icon>
                </a>
                <a href="{% url 'toggle_cohort' cohort.id %}" class="action-btn {% if cohort.is_active %}action-btn-warning{% else %}action-btn-success{% endif %}" title="{% if cohort.is_active %}Deactivate{% else %}Activate{% endif %}">
                  <iconify-icon icon="lucide:{% if cohort.is_active %}eye-off{% else %}eye{% endif %}"></iconify-icon>
                </a>
                <form method="post" action="{% url 'delete_cohort' cohort.id %}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this cohort?');">
                  {% csrf_token %}
                  <button type="submit" class="action-btn action-btn-delete" title="Delete">
                    <iconify-icon icon="lucide:trash-2"></iconify-icon>
                  </button>
                </form>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" style="text-align: center; padding: 40px; color: #86868b !important;">
              No cohorts found. <a href="{% url 'add_cohort' %}" style="color: #0071e3;">Create one</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Dimensions Section -->
  <div class="data-table fade-in-up" style="animation-delay: 0.2s; margin-bottom: 32px;">
    <div class="table-header">
      <h2 class="table-title">Dimensions</h2>
      <a href="{% url 'add_dimension' %}" class="btn btn-primary btn-sm">
        <iconify-icon icon="lucide:plus"></iconify-icon>
        Add Dimension
      </a>
    </div>
    <div class="table-content">
      <table>
        <thead>
          <tr>
            <th>Code</th>
            <th>Name</th>
            <th>Display Order</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for dimension in dimensions %}
          <tr>
            <td>
              <span class="badge badge-info" style="background: #dbeafe; color: #0071e3; border: 1px solid rgba(0, 113, 227, 0.2); font-weight: 600; font-size: 16px; padding: 8px 12px;">
                {{ dimension.code }}
              </span>
            </td>
            <td style="font-weight: 600;">{{ dimension.name }}</td>
            <td>{{ dimension.display_order }}</td>
            <td>
              {% if dimension.is_active %}
                <span class="badge badge-success">Active</span>
              {% else %}
                <span class="badge badge-danger">Inactive</span>
              {% endif %}
            </td>
            <td>
              <div class="action-buttons">
                <a href="{% url 'edit_dimension' dimension.id %}" class="action-btn action-btn-edit" title="Edit">
                  <iconify-icon icon="lucide:edit"></iconify-icon>
                </a>
                <a href="{% url 'toggle_dimension' dimension.id %}" class="action-btn {% if dimension.is_active %}action-btn-warning{% else %}action-btn-success{% endif %}" title="{% if dimension.is_active %}Deactivate{% else %}Activate{% endif %}">
                  <iconify-icon icon="lucide:{% if dimension.is_active %}eye-off{% else %}eye{% endif %}"></iconify-icon>
                </a>
                <form method="post" action="{% url 'delete_dimension' dimension.id %}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this dimension?');">
                  {% csrf_token %}
                  <button type="submit" class="action-btn action-btn-delete" title="Delete">
                    <iconify-icon icon="lucide:trash-2"></iconify-icon>
                  </button>
                </form>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" style="text-align: center; padding: 40px; color: #86868b !important;">
              No dimensions found. <a href="{% url 'add_dimension' %}" style="color: #0071e3;">Create one</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Pricing Section -->
  <div class="data-table fade-in-up" style="animation-delay: 0.3s; margin-bottom: 32px;">
    <div class="table-header">
      <h2 class="table-title">Pricing Configuration</h2>
      <a href="{% url 'add_pricing' %}" class="btn btn-primary btn-sm">
        <iconify-icon icon="lucide:plus"></iconify-icon>
        Add Pricing
      </a>
    </div>
    <div class="table-content">
      <table>
        <thead>
          <tr>
            <th>Enrollment Type</th>
            <th>Registration Fee</th>
            <th>Course Fee</th>
            <th>Total Amount</th>
            <th>Currency</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for pricing in pricing_configs %}
          <tr>
            <td style="font-weight: 600;">{{ pricing.get_enrollment_type_display }}</td>
            <td>
              {% if pricing.currency == 'USD' %}
                ${{ pricing.registration_fee|floatformat:2 }}
              {% else %}
                ₦{{ pricing.registration_fee|floatformat:2 }}
              {% endif %}
            </td>
            <td>
              {% if pricing.currency == 'USD' %}
                ${{ pricing.course_fee|floatformat:2 }}
              {% else %}
                ₦{{ pricing.course_fee|floatformat:2 }}
              {% endif %}
            </td>
            <td style="font-weight: 700; color: #0071e3;">
              {% if pricing.currency == 'USD' %}
                ${{ pricing.total_amount|floatformat:2 }}
              {% else %}
                ₦{{ pricing.total_amount|floatformat:2 }}
              {% endif %}
            </td>
            <td>
              <span class="badge badge-info" style="background: #dbeafe; color: #0071e3; border: 1px solid rgba(0, 113, 227, 0.2); font-weight: 600;">
                {{ pricing.currency|default:"USD" }}
              </span>
            </td>
            <td>
              {% if pricing.is_active %}
                <span class="badge badge-success">Active</span>
              {% else %}
                <span class="badge badge-danger">Inactive</span>
              {% endif %}
            </td>
            <td>
              <div class="action-buttons">
                <a href="{% url 'edit_pricing' pricing.id %}" class="action-btn action-btn-edit" title="Edit">
                  <iconify-icon icon="lucide:edit"></iconify-icon>
                </a>
                <a href="{% url 'toggle_pricing' pricing.id %}" class="action-btn {% if pricing.is_active %}action-btn-warning{% else %}action-btn-success{% endif %}" title="{% if pricing.is_active %}Deactivate{% else %}Activate{% endif %}">
                  <iconify-icon icon="lucide:{% if pricing.is_active %}eye-off{% else %}eye{% endif %}"></iconify-icon>
                </a>
                <form method="post" action="{% url 'delete_pricing' pricing.id %}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this pricing configuration?');">
                  {% csrf_token %}
                  <button type="submit" class="action-btn action-btn-delete" title="Delete">
                    <iconify-icon icon="lucide:trash-2"></iconify-icon>
                  </button>
                </form>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" style="text-align: center; padding: 40px; color: #86868b !important;">
              No pricing configurations found. <a href="{% url 'add_pricing' %}" style="color: #0071e3;">Create one</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Program Settings -->
  <div class="data-table fade-in-up" style="animation-delay: 0.4s; margin-top: 32px;">
    <div class="table-header">
      <h2 class="table-title">Program Settings</h2>
      <a href="{% url 'edit_program_settings' %}" class="btn btn-primary btn-sm">
        <iconify-icon icon="lucide:edit"></iconify-icon>
        Edit Settings
      </a>
    </div>
    <div class="table-content" style="padding: 24px;">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 24px;">
        <div>
          <h4 style="font-size: 16px; font-weight: 500; color: #86868b !important; margin-bottom: 8px;">Site Name</h4>
          <p style="font-size: 18px; font-weight: 600; color: #1d1d1f !important;">{{ settings.site_name }}</p>
        </div>
        <div>
          <h4 style="font-size: 16px; font-weight: 500; color: #86868b !important; margin-bottom: 8px;">Group 1 Age Range</h4>
          <p style="font-size: 18px; font-weight: 600; color: #1d1d1f !important;">{{ settings.group1_min_age }} - {{ settings.group1_max_age }} years</p>
        </div>
        <div>
          <h4 style="font-size: 16px; font-weight: 500; color: #86868b !important; margin-bottom: 8px;">Group 2 Age Range</h4>
          <p style="font-size: 18px; font-weight: 600; color: #1d1d1f !important;">{{ settings.group2_min_age }} - {{ settings.group2_max_age }} years</p>
        </div>
        <div>
          <h4 style="font-size: 16px; font-weight: 500; color: #86868b !important; margin-bottom: 8px;">Guardian Required Age</h4>
          <p style="font-size: 18px; font-weight: 600; color: #1d1d1f !important;">Under {{ settings.guardian_required_age }} years</p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
