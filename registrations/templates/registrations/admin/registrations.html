{% extends 'registrations/admin/base.html' %}
{% load static %}

{% block page_title %}Registrations{% endblock %}

{% block content %}
<div class="fade-in-up">
  <!-- Filters -->
  <form method="get" class="filter-bar">
    <input 
      type="text" 
      class="filter-input" 
      placeholder="Search by name, email, phone..."
      value="{{ search_query }}"
      name="search"
    >
    <select name="status" class="filter-select" onchange="this.form.submit()">
      <option value="">All Status</option>
      <option value="PAID" {% if status_filter == 'PAID' %}selected{% endif %}>Paid</option>
      <option value="PENDING" {% if status_filter == 'PENDING' %}selected{% endif %}>Pending</option>
      <option value="FAILED" {% if status_filter == 'FAILED' %}selected{% endif %}>Failed</option>
    </select>
    <select name="cohort" class="filter-select" onchange="this.form.submit()">
      <option value="">All Cohorts</option>
      {% for cohort in cohorts %}
      <option value="{{ cohort.id }}" {% if cohort_filter == cohort.id|stringformat:"s" %}selected{% endif %}>
        {{ cohort.name }}
      </option>
      {% endfor %}
    </select>
    <select name="dimension" class="filter-select" onchange="this.form.submit()">
      <option value="">All Dimensions</option>
      {% for dimension in dimensions %}
      <option value="{{ dimension.id }}" {% if dimension_filter == dimension.id|stringformat:"s" %}selected{% endif %}>
        {{ dimension.code }}: {{ dimension.name }}
      </option>
      {% endfor %}
    </select>
    <button type="submit" class="btn btn-primary">Apply Filters</button>
    <a href="{% url 'admin_registrations' %}" class="btn btn-secondary">Clear</a>
  </form>

  <!-- Registrations Table -->
  <div class="data-table">
    <div class="table-header">
      <h2 class="table-title">All Registrations ({{ registrations.count }})</h2>
      <a href="{% url 'add_registration' %}" class="btn btn-primary btn-sm">
        <iconify-icon icon="lucide:plus"></iconify-icon>
        Add New
      </a>
    </div>
    <div class="table-content">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Cohort</th>
            <th>Dimension</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for registration in registrations %}
          <tr>
            <td data-label="Name" style="font-weight: 600;">{{ registration.full_name }}</td>
            <td data-label="Email">{{ registration.email }}</td>
            <td data-label="Cohort">
              {% if registration.cohort %}
                <span class="badge badge-info">{{ registration.cohort.name }}</span>
              {% else %}
                -
              {% endif %}
            </td>
            <td data-label="Dimension">
              {% if registration.dimension %}
                <span class="badge badge-info">{{ registration.dimension.code }}</span>
              {% else %}
                -
              {% endif %}
            </td>
            <td data-label="Amount" style="font-weight: 600; color: #0071e3;">
              {% if registration.currency == 'NGN' %}
                â‚¦{{ registration.amount|floatformat:0 }}
              {% else %}
                ${{ registration.amount|floatformat:0 }}
              {% endif %}
            </td>
            <td data-label="Status">
              {% if registration.status == 'PAID' %}
                <span class="badge badge-success">Paid</span>
              {% elif registration.status == 'PENDING' %}
                <span class="badge badge-warning">Pending</span>
              {% else %}
                <span class="badge badge-danger">Failed</span>
              {% endif %}
            </td>
            <td data-label="Date">{{ registration.created_at|date:"M d, Y" }}</td>
            <td>
              <div class="action-buttons">
                <a href="{% url 'view_registration' registration.id %}" class="action-btn action-btn-view" title="View Details">
                  <iconify-icon icon="lucide:eye"></iconify-icon>
                </a>
                <a href="{% url 'edit_registration' registration.id %}" class="action-btn action-btn-edit" title="Edit">
                  <iconify-icon icon="lucide:edit"></iconify-icon>
                </a>
                <form method="post" action="{% url 'delete_registration' registration.id %}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this registration?');">
                  {% csrf_token %}
                  <button type="submit" class="action-btn action-btn-delete" title="Delete">
                    <iconify-icon icon="lucide:trash-2"></iconify-icon>
                  </button>
                </form>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="8" style="text-align: center; padding: 60px; color: #86868b;">
              <iconify-icon icon="lucide:inbox" style="font-size: 48px; opacity: 0.3; margin-bottom: 16px;"></iconify-icon>
              <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">No registrations found</div>
              <div>Try adjusting your filters</div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<style>
  .action-btn-view {
    background: #0071e3;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    text-decoration: none;
  }
  
  .action-btn-view:hover {
    background: #0077ed;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0, 113, 227, 0.2);
  }
  
  .action-buttons {
    display: flex;
    gap: 8px;
    align-items: center;
  }
</style>
{% endblock %}
